events.on("exit",function(){events.broadcast.emit("done",2)}),auto.waitFor(),images.requestScreenCapture(),sleep(300);var storage=storages.create("pref"),xoff=leftBlack()-246,flag=!0,teamregion=[269+xoff,166,16,16],teamx=43,sellflag=!1,guildflag=storage.get("guildflag",!1),Recoverflag=storage.get("Recoverflag",!1),stuckorloseflag=storage.get("stuckorloseflag",!1),sell=require("./\u5356\u88C5\u5907.js");if(!guildflag){var teamflag=storage.get("teamflag",!1),teamtype=storage.get("teamtype1",0),recoverflag=storage.get("recoverflag2",!1),raidmethod=storage.get("nraidmethod",0),difficulty1=storage.get("ndifficulty1",0),difficulty2=storage.get("ndifficulty2",0),health=280*(1-storage.get("nhealth",0)/100),optional=storage.get("optional1",!1),bosstype1=storage.get("nbosstype1",0),bosstype2=storage.get("nbosstype2",0),timeflag=storage.get("timeflag2",!1),timelimit=1e3*(60*(60*parseInt(storage.get("hour2",0))+parseInt(storage.get("minute2",0)))),time=new Date;timeflag&&threads.start(function(){setInterval(function(){new Date-time>timelimit&&exit()},6e4)});0===difficulty1?difficulty1="#aa66dd":1===difficulty1?difficulty1="#aa66dd":void 0;0===difficulty2?difficulty2="#aa66dd":1===difficulty2?difficulty2="#aa66dd":void 0;0===bosstype1?bosstype1="#ffff88":1===bosstype1?bosstype1="#ff6666":2===bosstype1?bosstype1="#6699ff":3===bosstype1?bosstype1="#77ee77":4===bosstype1?bosstype1="#ee77ff":void 0;0===bosstype2?bosstype2="#ffff88":1===bosstype2?bosstype2="#ff6666":2===bosstype2?bosstype2="#6699ff":3===bosstype2?bosstype2="#77ee77":4===bosstype2?bosstype2="#ee77ff":void 0}else{var teamflag=storage.get("teamflag",!1),teamtype=storage.get("teamtype1",0),recoverflag=storage.get("recoverflag4",!1),raidmethod=storage.get("graidmethod",0),difficulty1=storage.get("gdifficulty1",0),difficulty2=storage.get("gdifficulty2",0),health=280*(1-storage.get("ghealth",0)/100),optional=storage.get("optional2",!1),bosstype1=storage.get("gbosstype1",0),bosstype2=storage.get("gbosstype2",0),timeflag=storage.get("timeflag4",!1),timelimit=1e3*(60*(60*parseInt(storage.get("hour4",0))+parseInt(storage.get("minute4",0))));timeflag&&threads.start(function(){setInterval(function(){new Date-time>timelimit&&exit()},6e4)});0===difficulty1?difficulty1="#ff0033":1===difficulty1?difficulty1="#aa66dd":2===difficulty1?difficulty1="#ff9955":void 0;0===difficulty2?difficulty2="ff0033":1===difficulty2?difficulty2="#aa66dd":2===difficulty2?difficulty2="#ff9955":void 0;0===bosstype1?bosstype1="#ffff88":1===bosstype1?bosstype1="#ff6666":2===bosstype1?bosstype1="#6699ff":3===bosstype1?bosstype1="#77ee77":4===bosstype1?bosstype1="#ee77ff":5===bosstype1?bosstype1="#999999":void 0;0===bosstype2?bosstype2="#ffff88":1===bosstype2?bosstype2="#ff6666":2===bosstype2?bosstype2="#6699ff":3===bosstype2?bosstype2="#77ee77":4===bosstype2?bosstype2="#ee77ff":5===bosstype2?bosstype2="#999999":void 0}Recoverflag&&(recoverflag=!1),storage.put("Recoverflag",!1),threads.start(function(){for(sleep(111);;){var b=images.read("./reline.jpg");if(flag){flag=!1;try{var c=images.findImageInRegion(captureScreen(),b,1442+xoff,710,87,41)}catch(g){continue}flag=!0}if(b.recycle(),!c)log("not found reline"),c=void 0;else{log(c),click(c.x,c.y),log("open reline"),c=void 0,sleep(2e3);var d=images.read("./error.jpg");if(flag){flag=!1;var e=images.findImageInRegion(captureScreen(),d,1105+xoff,517,56,56);flag=!0}if(d.recycle(),!e)log("not found error");else{for(log(e),click(e.x,e.y),log("click error");;){if(flag){flag=!1;try{var f=images.detectsColor(captureScreen(),"#7ae6f4",2094+xoff,78,thresholdd=15)}catch(g){flag=!0;continue}flag=!0}if(!f)click(1112+xoff,512),sleep(2e3);else break}engines.execSciptFile("./\u8E6D\u8F66.js"),exit()}}sleep(9999)}});start:for(;;){help:for(;;){if(flag){flag=!1;var refreshbotton=images.findColorInRegion(captureScreen(),"#55bbcc",2036+xoff,248,5,5);flag=!0}if(!refreshbotton){var helpImg=images.fromBase64("iVBORw0KGgoAAAANSUhEUgAAABkAAAAZCAYAAADE6YVjAAAABHNCSVQICAgIfAhkiAAABS9JREFUSImdlVtsVFUUhr+zz5k57TADHab3K6WUIiIgGIViohjRSFBMvEaJqMCDYqI8AIag8qBoorxgggkJxvCA0QR9kZCYgCngBVsuIqRQuXSope303rl0zpzL9mGGMz0VTHC97Z211r/Xv9b6tyKEkFJKpJRMtLBfZf/99ayqmAaA4UjahpIsKw66Po6EjkSaZUcvYUnJznlVbJxVAoDpSFr64zx27C8EtzFdCJZGprjnkYzFa62d7LhwwwWIpgw2ne1i1LRpDOqsn1ns+sctm10dfUhAEwqU6D4E+Uo0RWFxOEDErwFgS0lP2iRlOxy4PkRAEywvCfHWmS7+GEkR0gTvzilHFwoAElAVhaerilhdWYRSHyyQ7Y/PdR3uxGKGxaMtHTQEdQ4ubeB2KcSicOB/ATgS+g0TW0r2LKq9LQCAaJ7A+51YxnHoiBt8fm8tFQW+//TV+tImX3UO5lEVqCn0s7w05L64ezzDkVjcE6gq0BgsYMmER46ZNu9fuMHFeBqAiF/ji0W1aJ91xNCFQmWBxpWEwRRN8HZjqQuSdhy+6Rpm87m/CftV1tZF+LJzkIdLQhxsnjmpOsmx/gRnRlLoQuGpyiKm+lS056vDfDC3nGtJg5XHL+MXCksj+V0wbMmvgwmKfCq7F9byQk2YNXURKgp8aIq3ERIwc/sW0AQv1U7P0vX1AzPc0hYWBehLm579yDgOf46Os2l2GWvqskGLw4Fbci/JLqFQoLzAx8rcIrvLWKgKnqycRlOowN0PS0r6DIvna6bz/twKN1HadrAmKQSAkutVQBWsrYvgz42cC6ILhSfKp9FcnK9CoFBd6OPDeZUuQF/a5NXWTq4mDIYzNt90Def9FSjWNeoCOm/m5MWSMg+Sdhxah5I8XBJyg1J2tumDGQuAAcPi9dYoP/aN8dtQkg2norT056dOoDAjoLO5qYyQpgIQNx1E23CKsyMpnvnlKqaUrCib6gYlLZud7b2sOnGZsyMpNrRFOdw7ypjpsPVcN4d6RknZjuvvFwrLS0O8nOtdxpEcH4ijLCkOymjCYOucct5uLHUDLCk5OZjkwZ8uoZAVOdPx9sEvFFZWTOP75gb3zpG429+XNrMq3D6WZttdXoCbrzg5lGROqIDvmht4sWY6k82WEE1mPHc3AZKWw96rA5wbHUfbNb+KdfXF/0qgALUBPyceaSLi13ioJIThOHw7odG2lPQZJoYjPfpnSUnbcJKP2nuywOvqi935nmiFquDZ6rA7zmG/yu6FNR4ZAbAcSVfKW02/YbHxdBdGLqeYWNrEl1yKpz2TA9l/Z+/iOkr1LHBAFaypi9AQ1L2UAUnbzp/jls0nF3vpSZvuZcaR/NAzyvq2KFeTRp5CBab6VBqCOgFV8EZDCZ/Or2ayyk/RVF6pi+RBvrw2yJ4rMQ8Nhi35eSBBNJXhzdPXsaTEkpLfh5KsaOmgfSzNrgXVfLag+pb/SEAVvFgz3e2TeiSW2BHSVD6+p4qAmt3NMdNm+/kbjJk2sbSFTyh0j5u8fLKTqkI/B5bUs7qqyE3qyOyfrufiFSWrIDHD4tRwKiukd0/16tXlhEFvjr64ZfPe+RuU6Bpbmsp4Z3aZZ5LGbYevrw+x79ogx5bPRs0pc8insqWpnEM9o2ibGkt5rjrsoer4QGICv4K3ZpWytamcsF/10JK0HHZfjrH9fDdFPo2jsbirGDdXYN99MxCf3FPlke6043C4d9Q9a4pCY1D/F0Dcstl+vpttf3bjyKwE7Y8OMtk0ofAP82Y2pQzz9G4AAAAASUVORK5CYII=");if(flag){flag=!1;try{var help=images.findImageInRegion(captureScreen(),helpImg,1187+xoff,261,36,34,0.9)}catch(b){flag=!0;continue}flag=!0}if(helpImg.recycle(),!help)log("not found help"),back();else{log(help),click(help.x,help.y),log("open help"),help=void 0;break}}else{refresh(),refreshbotton=void 0;break}sleep(2e3)}raidprc(teamflag,teamtype,health,raidmethod,difficulty1,difficulty2,bosstype1,bosstype2,recoverflag,guildflag)}function raidprc(b,c,d,e,f,g,h,i){boss:for(;;)switch(e){case 0:if(flag){flag=!1;var l=images.findMultiColors(captureScreen(),"#88dddd",[[280-d,0,"#88dddd"],[323,0,"#88dddd"],[536,-6,"#88dddd"],[632,-3,"#ffffff"],[903,-8,"#ffffff"],[1125,-3,"#88dddd"]]);flag=!0}if(!l){refresh();break}else if(log(l),click(l.x,l.y),l=void 0,battle(),sellflag){sellflag=!1;break boss}break;case 1:if(flag){flag=!1;var m=images.findMultiColors(captureScreen(),f,[[66,66,"#88dddd"],[345-d,66,"#88dddd"],[1243,-3,f]]);flag=!0}if(!m){if(optional){if(flag){flag=!1;var n=images.findMultiColors(captureScreen(),g,[[66,66,"#88dddd"],[345-d,66,"#88dddd"],[1243,-3,g]]);flag=!0}if(!n){refresh();break}else if(log(n),click(n.x,n.y),n=void 0,battle(),sellflag){sellflag=!1;break boss}}refresh()}else if(log(m),click(m.x,m.y),m=void 0,battle(),sellflag){sellflag=!1;break boss}break;case 2:if(flag){flag=!1;var m=images.findMultiColors(images.captureScreen(),f,[[-17,0,h],[345-d,66,"#88dddd"]]);flag=!0}if(m){if(click(m.x,m.y),log(m),m=void 0,battle(),sellflag){sellflag=!1;break boss}break}else{if(optional){if(flag){flag=!1;var n=images.findMultiColors(images.captureScreen(),g,[[-17,0,i],[345-d,66,"#88dddd"]]);flag=!0}if(!n){refresh();break}else if(log(n),click(n.x,n.y),n=void 0,battle(),sellflag){sellflag=!1;break boss}}refresh()}}}function battle(){re:for(;;){if(flag){flag=!1;var b=images.findColorInRegion(captureScreen(),"#ffffcc",1805+xoff,238,10,6);flag=!0}if(!b)log("not found simple");else{if(log("found simple"),b=void 0,teamflag){if(global.teamflag=!1,teamflag=!1,flag){for(flag=!1;!images.findColorInRegion(captureScreen(),"#ffffff",teamregion[0]+teamx*teamtype,teamregion[1],teamregion[2],teamregion[3]);)click(258+xoff,582),sleep(500);flag=!0}log("\u961F\u4F0D\u8BBE\u7F6E\u6210\u529F")}click(1873+xoff,997),log("open battle");var c=threads.disposable(),d=threads.start(function(){for(var l=new Date;5e3>new Date-l;){if(flag){flag=!1;var m=images.detectsColor(captureScreen(),"#ff5533",1609+xoff,137);flag=!0}if(!m)log("ap enough");else if(e.interrupt(),f.interrupt(),recoverflag){for(log(m),m=void 0,click(1639+xoff,592),log("clicked use");;){if(flag){flag=!1;var n=images.detectsColor(captureScreen(),"#ff5533",1255+xoff,818,threshold=16);flag=!0}if(!n)5e3<new Date-l&&(log("\u836F\u5403\u5B8C\u7ED3\u675F\u811A\u672C"),exit());else{n=void 0;break}sleep(109)}click(1759+xoff,530),log("clicked max"),click(1442+xoff,838),log("clicked recover"),c.setAndNotify("re"),log("\u5403\u836F\u7EBF\u7A0B\u7ED3\u675F1"),d.interrupt()}else back(),sleep(500),back(),exit();sleep(497)}c.setAndNotify("undefined"),log("\u5403\u836F\u7EBF\u7A0B\u7ED3\u675F2")}),e=threads.start(function(){var l=new Date;for(sleep(2);5e3>new Date-l;){if(flag){flag=!1;var m=images.findMultiColors(captureScreen(),"#ffffff",[[68,147,"#ffffff"],[595,144,"#ffffff"],[613,-3,"#ffffff"],[825,-207,"#88dddd"],[-162,-206,"#88dddd"]]);flag=!0}if(m){for(d.interrupt(),f.interrupt(),log("found bug");!click(m.x,m.y););for(m=void 0;;){if(flag){flag=!1;var n=images.detectsColor(captureScreen(),"#7ae6f4",2094+xoff,78,thresholdd=15);flag=!0}if(!n)click(1112+xoff,512),sleep(2e3);else break}engines.execScriptFile("./\u8E6D\u8F66.js"),exit()}else log("not found bug"),sleep(391)}c.setAndNotify("undefined"),log("bug\u7EBF\u7A0B\u7ED3\u675F")}),f=threads.start(function(){var l=new Date;for(sleep(3);5e3>new Date-l;){if(flag){flag=!1;var m=images.findMultiColors(captureScreen(),"#ffffff",[[-644,-480,"#88dddd"],[-644,-480,"#88dddd"],[745,-480,"#88dddd"]],{region:[1148+xoff,710,116,41]});flag=!0}m&&(d.interrupt(),e.interrupt(),log(m),click(m.x,m.y),m=void 0,log("close pop"),sleep(200),c.setAndNotify("break"),log("\u6EE1\u4EBA\u7EBF\u7A0B\u7ED3\u675F1"),f.interrupt()),log("not found pop"),sleep(597)}c.setAndNotify("undefined"),log("\u6EE1\u4EBA\u7EBF\u7A0B\u7ED3\u675F2")});if("re"==c.blockedGet()){log("\u6536\u5230\u518D\u6B21\u6218\u6597\u4FE1\u606F");continue re}else if("break"==c.blockedGet()){log("\u6536\u5230\u8FD4\u56DE\u8E6D\u8F66\u754C\u9762\u4FE1\u606F");break re}var g=!1;if(stuckorloseflag)var h=threads.start(function(){for(sleep(14999),log("\u5361\u6B7B\u68C0\u6D4B\u5F00\u59CB");;){if(flag){flag=!1;var l=captureScreen(),m=images.clip(l,1173,42,157,22);flag=!0}if(!m)continue;else if(log("boss hp clipped down"),log("waitting...."),sleep(18003),flag){if(flag=!1,images.findImageInRegion(captureScreen(),m,1173+xoff,42,157,22,0.9)){for(m.recycle(),i.interrupt(),g=!0,sleep(500),log("get stuck"),log("\u5173\u95ED\u56E2\u706D\u68C0\u6D4B");!click(2066+xoff,90););for(var n=new Date;!(3500<new Date-n);)if(images.detectsColor(captureScreen(),"#85dee1",1494+xoff,828,threshold=15)){for(;!click(1606+xoff,846););for(sleep(1500);!click(1375+xoff,721););log("\u5361\u6B7B\u5DF2\u9000\u51FA"),sleep(500),g=!1,flag=!0,h.interrupt()}else sleep(297)}flag=!0}log("not stuck"),sleep(3197)}}),i=threads.start(function(){for(sleep(20009);;){if(flag){flag=!1;var l=images.findMultiColors(captureScreen(),"#ffffff",[[306,-2,"#ffffff"],[479,5,"#ffffff"],[-425,-185,"#88dddd"],[963,-185,"#88dddd"]]);flag=!0}if(l){for(l=void 0,g=!0,h.interrupt(),log("\u5173\u95ED\u5361\u6B7B\u68C0\u6D4B"),log("\u5DF2\u56E2\u706D"),sleep(500);!click(767+xoff,734););for(;!click(767+xoff,734););log("\u56E2\u706D\u8FD4\u56DE\u754C\u9762"),sleep(500),g=!1,i.interrupt()}else log("\u672A\u56E2\u706D");sleep(8307)}});for(;;){if(guildflag){if(flag){flag=!1;var j=images.findMultiColors(captureScreen(),"#ffffff",[[-174,24,"#ff6840"],[208,17,"#ff6840"],[-449,-160,"#ff5533"],[454,-154,"#ff5533"],[-681,-534,"#88dddd"],[706,-536,"#88dddd"]]);flag=!0}if(j){for(log(j),click(j.x,j.y),j=void 0,sleep(2500),click(2043+xoff,68),sleep(2500);!sell(););return void(sellflag=!0)}log("not full")}if(flag){flag=!1;var k=images.findColorInRegion(captureScreen(),"#55bbcc",2036+xoff,248,5,5);flag=!0}if(!k)log("not found refresh"),g||(press(1830+xoff,220,1),press(2103+xoff,865,1));else{k=void 0,stuckorloseflag&&(i.interrupt(),h.interrupt(),log("\u5361\u6B7B\u7EBF\u7A0B\u7ED3\u675F"),log("\u56E2\u706D\u7EBF\u7A0B\u7ED3\u675F"));break re}sleep(500)}}sleep(300)}}function refresh(){for(;;){if(flag){flag=!1;var b=images.findColorInRegion(captureScreen(),"#55bbcc",2036+xoff,248,5,5);flag=!0}if(!b)log("not  found refresh and wait");else{click(b.x,b.y),b=void 0,log("has found refresh");break}sleep(1500)}for(;;){if(flag){flag=!1;var c=images.findColorInRegion(captureScreen(),"#666666",2036+xoff,248,5,5);flag=!0}if(!c)log("not  found grefresh and wait");else{c=void 0,log("has found grefresh");break}sleep(20)}}function leftBlack(){var b=images.captureScreen(),c=b.height,d=0,e=c/2;if(1920==b.width)return 0;for(;d<b.width-1;){if(b.pixel(d,e)!=b.pixel(d+1,e))return 0==d?d:d+1;d++}return d+1}
