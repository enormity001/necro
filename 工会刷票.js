auto.waitFor(),auto.setMode("normal"),images.requestScreenCapture(),sleep(300);var storage=storages.create("pref"),xoff=leftBlack()-246,partflag=!0,parttype=storage.get("partflag2",!1),flag=!0,rebattleflag=!0,speedtype=2,autotype=1,teamtype=storage.get("teamtype4",0),speedflag=!0,autoflag=!0,teamflag=storage.get("teamflag",!1),recoverflag=storage.get("recoverflag5",!1),usediamond=storage.get("usediamond5",!1),timeflag=storage.get("timeflag6",!1),timelimit=1e3*(60*(60*parseInt(storage.get("hour6",0))+parseInt(storage.get("minute6",0)))),time=new Date,teamregion=[269+xoff,166,16,16],teamx=43;for(timeflag&&threads.start(function(){setInterval(function(){new Date-time>timelimit&&exit()},6e4)}),threads.start(function(){for(;;){var b=images.read("./reline.jpg");if(flag){flag=!1;var c=images.findImageInRegion(captureScreen(),b,1442+xoff,710,87,41);flag=!0}if(b.recycle(),!c)log("not found reline");else{log(c),click(c.x,c.y),log("open reline"),sleep(2e3);var d=images.read("./error.jpg");if(flag){flag=!1;var e=images.findImageInRegion(captureScreen(),d,1105+xoff,517,56,56);flag=!0}d.recycle(),e?(log(e),click(e.x,e.y),log("click error"),engines.execSciptFile("./\u5DE5\u4F1A\u5237\u7968.js"),exit()):log("not found error")}sleep(9999)}});;){var questImg=images.read("./quest.jpg");if(flag){flag=!1;var quest=images.findImageInRegion(captureScreen(),questImg,1869+xoff,972,137,65);flag=!0}if(questImg.recycle(),!quest)log("not found quest"),back();else{log(quest),click(quest.x,quest.y),log("open quest");break}sleep(1500)}for(sleep(1e3),click(1927+xoff,863),sleep(3e3);;){if(flag){flag=!1;var solo=images.findColorInRegion(captureScreen(),"#65d5e6",1499+xoff,897,6,6,threshold=10);flag=!0}if(!solo)log("not found solo");else{log(solo),click(solo.x,solo.y),log("open solo");break}sleep(800)}sleep(1e3),click(1745+xoff,355),sleep(3e3);re:for(;;)normalbattleprc(partflag,speedflag,speedtype,autoflag,autotype,teamflag,teamtype,recoverflag,rebattleflag),sleep(1e3);function normalbattleprc(b,c,d,e,f,g,h,i,j){re:for(;;){if(flag){flag=!1;var k=images.findColorInRegion(captureScreen(),"#ffffcc",1805+xoff,238,10,6);flag=!0}if(!k)log("not found simple"),click(409+xoff,227);else{if(log("found simple"),g){if(global.teamflag=!1,g=!1,flag){for(flag=!1;!images.findColorInRegion(captureScreen(),"#ffffff",teamregion[0]+teamx*h,teamregion[1],teamregion[2],teamregion[3]);)click(258+xoff,582),sleep(500);flag=!0}log("\u961F\u4F0D\u8BBE\u7F6E\u6210\u529F")}if(c){if(global.speedflag=!1,c=!1,flag){switch(flag=!1,d){case 0:for(;!images.detectsColor(captureScreen(),"#ffffff",1489+xoff,1009,threshold=20);)click(1371+xoff,964),sleep(400);log("\u8C03\u901F\u4E3A1x");break;case 1:for(;!images.detectsColor(captureScreen(),"#e85533",1570+xoff,1017,threshold=20);)click(1371+xoff,964),sleep(400);log("\u8C03\u901F\u4E3A2x");break;case 2:for(;!images.detectsColor(captureScreen(),"#f85533",1558+xoff,1014,threshold=20);)click(1371+xoff,964),sleep(400);log("\u8C03\u901F\u4E3A3x");break;default:for(;!images.detectsColor(captureScreen(),"#f85533",1558+xoff,1014,threshold=20);)click(1371+xoff,964),sleep(400);log("\u8C03\u901F\u4E3A3x");}flag=!0}log("\u8C03\u901F\u6210\u529F")}click(1873+xoff,997),log("open battle");var l=threads.disposable(),m=threads.start(function(){for(var r=new Date;5e3>new Date-r;){if(flag){flag=!1;var s=images.detectsColor(captureScreen(),"#ff5533",1609+xoff,137);flag=!0}if(!s)log("ap enough");else if(i){for(log(s),s=null,usediamond?click(1624+xoff,439):click(1639+xoff,592),log("clicked use");;){if(flag){flag=!1;var t=images.detectsColor(captureScreen(),"#ff5533",1255+xoff,818,threshold=16);flag=!0}if(!t)4500<new Date-r&&(log("\u836F\u5403\u5B8C\u7ED3\u675F\u811A\u672C"),exit());else{t=null;break}sleep(199)}click(1759+xoff,530),sleep(700),log("clicked max"),click(1442+xoff,838),log("clicked recover"),l.setAndNotify("re"),m.interrupt()}else back(),sleep(500),back(),exit();sleep(500)}l.setAndNotify("null")});if("re"==l.blockedGet())for(;;){if(flag){flag=!1;var k=images.findColorInRegion(captureScreen(),"#ffffcc",1805+xoff,238,10,6);flag=!0}if(k){click(1873+xoff,997),log("\u5403\u836F\u6210\u529F\uFF0C\u518D\u6B21\u5F00\u59CB"),sleep(400);break}sleep(500)}for(;;){if(flag){flag=!1;var n=images.findMultiColors(captureScreen(),"#ffffff",[[-68,96,"#598ad9"],[-42,135,"#60c160"]],{threshold:15});flag=!0}if(!n)log("not found esc"),click(345+xoff,353);else{if(log(n),log("found esc"),e){switch(global.autoflag=!1,e=!1,f){case 0:var o=images.read("./still.jpg");break;case 1:var o=images.read("./autoskill.jpg");break;default:var o=images.read("./autoskill.jpg");}if(flag){for(flag=!1;!images.findImageInRegion(captureScreen(),o,1700+xoff,50,153,36);)click(1786+xoff,68),sleep(500);flag=!0}o.recycle(),log("\u4EBA\u7269\u72B6\u6001\u8BBE\u7F6E\u5B8C\u6210")}for(sleep(3e3);;){var p=images.read("./next.jpg");if(flag){flag=!1;var q=images.findImageInRegion(captureScreen(),p,1404+xoff,991,38,38);flag=!0}if(p.recycle(),!q)log("not found next"),stuckorlose||(press(1790+xoff,186,1),press(1818+xoff,186,1));else{if(log("found next"),b){if(sleep(100),parttype){if(flag){for(flag=!1;!images.detectsColor(captureScreen(),"#88dddd",647+xoff,1037);)click(699+xoff,978),sleep(100);flag=!0}log("\u52A9\u6218\u5F00\u542F")}else{if(flag){for(flag=!1;!images.detectsColor(captureScreen(),"#666666",598+xoff,1037);)click(699+xoff,978),sleep(100);flag=!0}log("\u52A9\u6218\u5173\u95ED")}global.partflag=!1,b=!1}if(j)log("rebattle"),click(996+xoff,1009);else{log("next"),click(q.x,q.y);break re}continue re}sleep(1e3)}}sleep(1e3)}}sleep(1e3)}}function leftBlack(){var b=images.captureScreen(),c=b.height,d=0,e=c/2;if(1920==b.width)return 0;for(;d<b.width-1;){if(b.pixel(d,e)!=b.pixel(d+1,e))return 0==d?d:d+1;d++}return d+1}
